<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Measurely Report</title>

<link rel="stylesheet" href="file:///home/matt/measurely/web/report.css">

<style>
@font-face {
    font-family: 'Inter';
    src: url('file:///home/matt/measurely/web/fonts/inter/interweb/Inter-V.ttf') format('truetype');
}
</style>

<script src="file:///home/matt/measurely/web/js/plotly.min.js"></script>
</head>

<body>

<div id="report">

    <!-- HEADER -->
    <div class="header">
        <img class="logo" src="file:///home/matt/measurely/web/icons/mainlogo.png" alt="Measurely">

        <div class="title-block">
            <h1>Room Report</h1>
            <p class="subtitle">Latest Measurement</p>
        </div>
    </div>

    <!-- OVERALL SCORE -->
    <div class="score-card card score-split">

        <div class="score-left">
            <h2>Overall Score</h2>
            <div class="score-value">
                <span id="score-value">0.0</span>
                <span class="score-max">/10</span>
            </div>
        </div>

        <div class="score-right">
            <div class="dave-badge report-badge">
                <img src="icons/dave.svg" width="20" alt="" aria-hidden="true">
                <span>Report</span>
            </div>

            <p class="score-desc">
                Generated by Measurely, a room analysis tool that measures how your listening space affects sound.
                The overall room score reflects a balance of six key acoustic factors at the listening position.
            </p>
        </div>

    </div>

    <!-- METRICS GRID -->
    <div class="metrics-grid">

        <!-- PEAKS & DIPS -->
        <div class="metric card">
            <div class="metric-header">
                <span class="metric-title">PEAKS & DIPS</span>
                <img class="metric-icon" src="icons/mountain.svg" alt="" aria-hidden="true">
            </div>
            <div class="metric-value" id="m-peaks">0.0</div>
            <p class="metric-desc">
                Measures uneven boosts and cancellations in the frequency response.
            </p>
        </div>

        <!-- REFLECTIONS -->
        <div class="metric card">
            <div class="metric-header">
                <span class="metric-title">REFLECTIONS</span>
                <img class="metric-icon" src="icons/square-caret-left.svg" alt="" aria-hidden="true">
            </div>
            <div class="metric-value" id="m-reflections">0.0</div>
            <p class="metric-desc">
                Indicates early wall and floor reflections affecting clarity.
            </p>
        </div>

        <!-- BANDWIDTH -->
        <div class="metric card">
            <div class="metric-header">
                <span class="metric-title">BANDWIDTH</span>
                <img class="metric-icon" src="icons/signal.svg" alt="" aria-hidden="true">
            </div>
            <div class="metric-value" id="m-bandwidth">0.0</div>
            <p class="metric-desc">
                Shows how evenly sound is reproduced across the frequency range.
            </p>
        </div>

        <!-- SMOOTHNESS -->
        <div class="metric card">
            <div class="metric-header">
                <span class="metric-title">SMOOTHNESS</span>
                <img class="metric-icon" src="icons/wave-square.svg" alt="" aria-hidden="true">
            </div>
            <div class="metric-value" id="m-smoothness">0.0</div>
            <p class="metric-desc">
                Reflects tonal consistency through bass and lower midrange.
            </p>
        </div>

        <!-- REVERB -->
        <div class="metric card">
            <div class="metric-header">
                <span class="metric-title">REVERB</span>
                <img class="metric-icon" src="icons/clock.svg" alt="" aria-hidden="true">
            </div>
            <div class="metric-value" id="m-reverb">0.0</div>
            <p class="metric-desc">
                Measures how long sound energy persists in the room.
            </p>
        </div>

        <!-- BALANCE -->
        <div class="metric card">
            <div class="metric-header">
                <span class="metric-title">BALANCE</span>
                <img class="metric-icon" src="icons/balance-scale.svg" alt="" aria-hidden="true">
            </div>
            <div class="metric-value" id="m-balance">0.0</div>
            <p class="metric-desc">
                Represents left-to-right level consistency at the listening position.
            </p>
        </div>

    </div>

    <!-- GRAPH -->
    <div class="graph card">
        <div id="freqChart" style="width:100%; height:480px;"></div>
        <p class="graph-explainer">
            Frequency response measured at the listening position.
            Flatter curves generally indicate more balanced sound, while peaks and dips reflect room interaction.
        </p>

    </div>

    <div class="report-footer">
        <p>
            <strong>Measurely</strong> — Room analysis for hi-fi listening spaces<br>
            <span>www.measurely.uk · info@measurely.uk</span>
        </p>
    </div>

</div>

<div id="report-ready"></div>

<!-- SCRIPT -->
<script>
document.addEventListener("DOMContentLoaded", async () => {

    const s = await window.getSweepData();

    // Numbers
    document.getElementById("score-value").textContent = s.score.toFixed(1);
    document.getElementById("m-peaks").textContent = s.metrics.peaks_dips.toFixed(1);
    document.getElementById("m-reflections").textContent = s.metrics.reflections.toFixed(1);
    document.getElementById("m-bandwidth").textContent = s.metrics.bandwidth.toFixed(1);
    document.getElementById("m-smoothness").textContent = s.metrics.smoothness.toFixed(1);
    document.getElementById("m-reverb").textContent = s.metrics.reverb.toFixed(1);
    document.getElementById("m-balance").textContent = s.metrics.balance.toFixed(1);

    // Frequency response
    Plotly.newPlot(
        "freqChart",
        [{
            x: s.freqs,
            y: s.mag,
            mode: "lines",
            line: { color: "#a855f7", width: 3 }
        }],
        {
            paper_bgcolor: "rgba(0,0,0,0)",
            plot_bgcolor: "#1f2937",
            margin: { t: 20, r: 20, b: 50, l: 60 },
            xaxis: {
                type: "log",
                range: [Math.log10(20), Math.log10(20000)],
                tickvals: [20,50,100,200,500,1000,2000,5000,10000,20000],
                ticktext: ["20","50","100","200","500","1k","2k","5k","10k","20k"],
                showline: true,
                gridcolor: "rgba(255,255,255,0.06)",
                tickfont: { color: "#e5e7eb" },
                title: { text: "Frequency (Hz)", font: { color: "#e5e7eb" } }
            },
            yaxis: {
                range: [-10, 15],
                showline: true,
                gridcolor: "rgba(255,255,255,0.06)",
                tickfont: { color: "#e5e7eb" },
                title: { text: "Level (dB)", font: { color: "#e5e7eb" } }
            },
            showlegend: false
        },
        {
            staticPlot: true,
            displayModeBar: false
        }
    );

    document.getElementById("report-ready").setAttribute("data-ready", "1");
});
</script>

</body>
</html>
